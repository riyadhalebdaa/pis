<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>School Display</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:Arial;background:#fff;overflow:hidden;}

/* LOADING SCREEN */
#loadingScreen{
position:fixed;
top:0;
left:0;
width:100%;
height:100%;
background:#000;
color:#fff;
display:flex;
flex-direction:column;
justify-content:center;
align-items:center;
font-size:28px;
z-index:2000;
direction:rtl;
transition:opacity 0.8s ease;
opacity:1;
}

#progressContainer{
width:400px;
height:20px;
background:#333;
margin-top:25px;
border-radius:10px;
overflow:hidden;
}

#progressBar{
height:100%;
width:0%;
background:#00c853;
transition:width 0.3s;
}

#progressText{
margin-top:15px;
font-size:22px;
}

/* LOGO */
.logo-container{
position:absolute;top:20px;right:30px;
background:#fff;padding:15px 40px;
border-radius:20px;box-shadow:0 10px 25px rgba(0,0,0,0.08);
z-index:10;
}
.logo-container img{height:70px;}

/* SLIDER */
.slider{position:fixed;width:100%;height:100%;z-index:-2;}
.slide{
position:absolute;width:100%;height:100%;
object-fit:cover;opacity:0;
transition:opacity 1.5s ease-in-out;
}
.slide.active{opacity:1;}

/* CLOCK */
.clock{
position:absolute;
top:40px;
left:40px;
width:240px;
height:240px;
border-radius:50%;
background:rgba(255,255,255,0.50);
backdrop-filter: blur(6px);
border:6px solid rgba(0,0,0,0.75);
box-shadow:
0 0 0 6px rgba(255,255,255,0.6),
0 15px 35px rgba(0,0,0,0.25);
display:flex;
justify-content:center;
align-items:center;
}

.center{
position:absolute;
width:16px;
height:16px;
background:#000;
border-radius:50%;
z-index:10;
}

.clock-logo{
position:absolute;
width:50px;
z-index:2;
top:30%;
left:50%;
transform:translate(-50%,-50%);
pointer-events:none;
}

.hand{
position:absolute;
bottom:50%;
transform-origin:bottom;
border-radius:10px;
z-index:5;
}

.hour{width:7px;height:65px;background:#111;}
.minute{width:4px;height:95px;background:#333;}
.second{width:2px;height:105px;background:#d40000;}

.number{
position:absolute;
font-size:22px;
font-weight:500;
color:#111;
transform:translate(-50%,-50%);
z-index:6;
}

.number.bold{
font-weight:800;
font-size:29px;
}

.tick{
position:absolute;
width:3px;
height:7px;
background:#222;
top:5px;
left:49%;
transform-origin:50% 110px;
}
.tick.small{height:3px;width:2px;background:#555;}

.status{
position:absolute;bottom:40px;right:40px;
background:rgba(255,255,255,0.95);
padding:18px 35px;border-radius:15px;
font-size:22px;font-weight:bold;
box-shadow:0 10px 25px rgba(0,0,0,0.15);
display:none;line-height:1.8;direction:rtl;
text-align:right;
}

.overlay{
position:fixed;
top:0;left:0;width:100%;height:100%;
background:rgba(0,0,0,0.65);
display:flex;justify-content:center;align-items:center;
color:#fff;font-size:46px;font-weight:bold;
padding:40px;
opacity:0;visibility:hidden;
transition:opacity 0.6s ease;
z-index:999;
}

.overlay-content{
direction:rtl;text-align:right;
transform:scale(0.8);
opacity:0;
transition:transform 0.6s ease, opacity 0.6s ease;
}

.overlay.show{opacity:1;visibility:visible;}
.overlay.show .overlay-content{transform:scale(1);opacity:1;}
.overlay.hide .overlay-content{transform:scale(0.6);opacity:0;}

.date-box{
  position:absolute;
  bottom:40px;
  left:40px;
  background:rgba(255,255,255,0.95);
  padding:18px 30px;
  border-radius:15px;
  font-size:20px;
  font-weight:bold;
  box-shadow:0 10px 25px rgba(0,0,0,0.15);
  direction:rtl;
  text-align:right;
  line-height:1.8;
}

#bgVideo{
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  object-fit: cover;   /* Ø£Ù‡Ù… Ø³Ø·Ø± */
  z-index: -1;
}

</style>
</head>
<body>

<video id="bgVideo" autoplay muted loop playsinline style="display:none;">
  <source src="video/rc.mp4" type="video/mp4">
</video>

<div id="loadingScreen">
<div>â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù…...</div>
<div id="progressContainer">
<div id="progressBar"></div>
</div>
<div id="progressText">0%</div>
</div>

<div class="logo-container">
<img src="logo.png">
</div>

<div class="slider" id="slider"></div>

<div class="clock">
<img src="logo_without_texts.png" class="clock-logo">
<div class="hand hour"></div>
<div class="hand minute"></div>
<div class="hand second"></div>
<div class="center"></div>
</div>

<div class="status" id="statusBox"></div>
<div class="date-box" id="dateBox"></div>
<div class="overlay" id="overlay"></div>

<script>

/* CLOCK */
const hour=document.querySelector(".hour");
const minute=document.querySelector(".minute");
const second=document.querySelector(".second");
const clock=document.querySelector(".clock");

const arabicNumbers=["Ù¡","Ù¢","Ù£","Ù¤","Ù¥","Ù¦","Ù§","Ù¨","Ù©","Ù¡Ù ","Ù¡Ù¡","Ù¡Ù¢"];

for(let i=1;i<=12;i++){
const num=document.createElement("div");
num.classList.add("number");
if([3,6,9,12].includes(i)){num.classList.add("bold");}
num.textContent=arabicNumbers[i-1];
const angle=(i*30)*(Math.PI/180);
const radius=87;
const x=113 + radius*Math.sin(angle);
const y=116 - radius*Math.cos(angle);
num.style.left=x+"px";
num.style.top=y+"px";
clock.appendChild(num);
}

for(let i=0;i<60;i++){
const tick=document.createElement("div");
tick.classList.add("tick");
if(i%5!==0){tick.classList.add("small");}
tick.style.transform=`rotate(${i*6}deg)`;
clock.appendChild(tick);
}

function updateClock(){
const now=new Date();
const h=now.getHours()%12;
const m=now.getMinutes();
const s=now.getSeconds();
hour.style.transform=`rotate(${(h*30)+(m*0.5)}deg)`;
minute.style.transform=`rotate(${m*6}deg)`;
second.style.transform=`rotate(${s*6}deg)`;
}
setInterval(updateClock,1000);
updateClock();


/* DATE (Hijri + Gregorian) */

function toArabicDigits(str){
  const map = {
    "0":"Ù ","1":"Ù¡","2":"Ù¢","3":"Ù£","4":"Ù¤",
    "5":"Ù¥","6":"Ù¦","7":"Ù§","8":"Ù¨","9":"Ù©"
  };
  return str.replace(/[0-9]/g, d => map[d]);
}

function updateDate(){

  const now = new Date();

  // Ø§Ù„ÙŠÙˆÙ… Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©
  const days = [
    "Ø§Ù„Ø£Ø­Ø¯","Ø§Ù„Ø§Ø«Ù†ÙŠÙ†","Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡",
    "Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡","Ø§Ù„Ø®Ù…ÙŠØ³","Ø§Ù„Ø¬Ù…Ø¹Ø©","Ø§Ù„Ø³Ø¨Øª"
  ];

  const dayName = days[now.getDay()];

  // Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ÙŠ
  const gregorianFormatter = new Intl.DateTimeFormat("ar-EG",{
    day:"numeric",
    month:"long",
    year:"numeric"
  });

  const gregorianDate = gregorianFormatter.format(now);

  // Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ
  const hijriFormatter = new Intl.DateTimeFormat("ar-SA-u-ca-islamic",{
    day:"numeric",
    month:"long",
    year:"numeric"
  });

   let hijriDate = hijriFormatter.format(now);

   // Ù†Ø´ÙŠÙ„ Ø£ÙŠ Ø±Ù…Ø² Ø³Ù†Ø© Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ù‹Ø§ (Ù„Ùˆ Ø¸Ù‡Ø±)
     hijriDate = hijriDate.replace(/\s?Ù‡Ù€/, "").trim();

   // Ù†Ø¶ÙŠÙ Ù‡Ù€ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø³Ù†Ø© Ø¨Ø¯ÙˆÙ† Ù…Ø³Ø§ÙØ©
   hijriDate += "Ù‡Ù€";

  document.getElementById("dateBox").innerHTML = `
    ${dayName} ${toArabicDigits(hijriDate)}<br>
    Ø§Ù„Ù…ÙˆØ§ÙÙ‚ ${toArabicDigits(gregorianDate)}Ù…
  `;
}

updateDate();
setInterval(updateDate, 60000);


function toMin(t){const [h,m]=t.split(":").map(Number);return h*60+m;}

const schedule=[
{name:"Ø§Ù„Ø­ØµØ© Ø§Ù„Ø£ÙˆÙ„Ù‰",start:"09:00",end:"09:35",sound:"00.MP3"},
{name:"Ø§Ù„Ø­ØµØ© Ø§Ù„Ø«Ø§Ù†ÙŠØ©",start:"09:35",end:"10:10",sound:"01.MP3"},
{name:"Ø§Ù„Ø­ØµØ© Ø§Ù„Ø«Ø§Ù„Ø«Ø©",start:"10:10",end:"10:45",sound:"02.MP3"},
{name:"Ø§Ù„Ø­ØµØ© Ø§Ù„Ø±Ø§Ø¨Ø¹Ø©",start:"10:45",end:"11:20",sound:"03.MP3"},
{name:"Ø§Ù„Ø­ØµØ© Ø§Ù„Ø®Ø§Ù…Ø³Ø©",start:"11:20",end:"11:55",sound:"04.MP3"},
{name:"Ø§Ù„Ø­ØµØ© Ø§Ù„Ø³Ø§Ø¯Ø³Ø©",start:"11:55",end:"12:30",sound:"05.MP3"},
{name:"Ø£Ø¯Ø§Ø¡ ØµÙ„Ø§Ø© Ø§Ù„Ø¸Ù‡Ø±",start:"12:30",end:"12:45",sound:"06.MP3"}
];

/* PRELOAD AUDIO */
const preloadedAudio = {};
let totalLoadedBytes = 0;
let totalBytes = 0;
let loadedFiles = 0;

function preloadSounds(){

  schedule.forEach(event=>{

    const audio = new Audio(`audio/${event.sound}`);
    audio.preload = "auto";

    audio.addEventListener("loadedmetadata",()=>{
      if(audio.duration){
        totalBytes += 1; 
      }
    });

    audio.addEventListener("progress",()=>{
      if(audio.buffered.length > 0){
        const loaded = audio.buffered.end(0);
        const percent = Math.min((loaded / audio.duration) * 100, 100);

        // Ù…ØªÙˆØ³Ø· ØªÙ‚Ø±ÙŠØ¨ÙŠ Ù„ÙƒÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª
        const overall = Math.round(
          ((loadedFiles + (percent/100)) / schedule.length) * 100
        );

        document.getElementById("progressBar").style.width = overall + "%";
        document.getElementById("progressText").innerText = overall + "%";
      }
    });

    audio.addEventListener("canplaythrough",()=>{
      loadedFiles++;

      if(loadedFiles === schedule.length){
        setTimeout(()=>{
          const loading=document.getElementById("loadingScreen");
          loading.style.opacity="0";
          setTimeout(()=>{
            loading.style.display="none";
            startSystem();
          },800);
        },500);
      }
    });

    audio.load();
    preloadedAudio[event.sound]=audio;

  });

}

let lastEvent=localStorage.getItem("lastEvent")||"";
let prevEvent=null;

function getCurrent(arr,current){
return arr.find(e=>current>=toMin(e.start)&&current<toMin(e.end));
}

function checkSchedule(){
const now=new Date();
const current=now.getHours()*60+now.getMinutes();
const currentEvent=getCurrent(schedule,current);
const box=document.getElementById("statusBox");

if(currentEvent){
box.style.display="block";
box.innerHTML=`ğŸŸ¢ Ø§Ù„Ø¢Ù† ${currentEvent.name}`;
}else{
box.style.display="none";
}

const today = new Date().getDay(); 
// Ø§Ù„Ø£Ø­Ø¯=0 ... Ø§Ù„Ø¬Ù…Ø¹Ø©=5 ... Ø§Ù„Ø³Ø¨Øª=6

const blockedDays = [5,6]; // Ø§Ù„Ø¬Ù…Ø¹Ø© ÙˆØ§Ù„Ø³Ø¨Øª

if(currentName !== lastEvent && currentEvent){

  if(!blockedDays.includes(today)){
    showTransition(prevEvent, currentEvent);
  }

  localStorage.setItem("lastEvent", currentName);
  lastEvent = currentName;
}prevEvent=currentEvent||null;
}

function showTransition(oldEvent,newEvent){
const overlay=document.getElementById("overlay");
if(!newEvent)return;

let message="";
if(oldEvent&&oldEvent.name!==newEvent.name){
message=`ğŸŸ¢ Ø§Ù†ØªÙ‡Øª ${oldEvent.name}<br>ÙˆØªØ¨Ø¯Ø£ Ø§Ù„Ø¢Ù† ${newEvent.name}`;
}else if(!oldEvent){
message=`ğŸŸ¢ ØªØ¨Ø¯Ø£ Ø§Ù„Ø¢Ù† ${newEvent.name}`;
}else{return;}

overlay.innerHTML=`<div class="overlay-content">${message}</div>`;
overlay.classList.remove("hide");
overlay.classList.add("show");

if(preloadedAudio[newEvent.sound]){
preloadedAudio[newEvent.sound].currentTime=0;
preloadedAudio[newEvent.sound].play();
}

setTimeout(()=>{
overlay.classList.add("hide");
setTimeout(()=>{
overlay.classList.remove("show","hide");
},600);
},12000);
}

function startSystem(){
setInterval(checkSchedule,1000);
checkSchedule();
}

preloadSounds();

/* SLIDER */
const slider=document.getElementById("slider");
let slides=[],currentSlide=0;
for(let i=1;i<=300;i++){
let img=document.createElement("img");
img.src=`preimg/Slide${i}.JPG`;
img.classList.add("slide");
slider.appendChild(img);
slides.push(img);
}
slides[0].classList.add("active");
setInterval(()=>{
slides[currentSlide].classList.remove("active");
currentSlide=(currentSlide+1)%slides.length;
slides[currentSlide].classList.add("active");
},5000);

function checkVideoSchedule(){

  const now = new Date();

  const day = now.getDay(); 
  // Ø§Ù„Ø£Ø­Ø¯=0ØŒ Ø§Ù„Ø§Ø«Ù†ÙŠÙ†=1ØŒ Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡=2ØŒ Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡=3ØŒ Ø§Ù„Ø®Ù…ÙŠØ³=4ØŒ Ø§Ù„Ø¬Ù…Ø¹Ø©=5ØŒ Ø§Ù„Ø³Ø¨Øª=6

  const currentMinutes = now.getHours()*60 + now.getMinutes();

  const start = 21*60 + 20;   // 9:20 PM
  const end   = 24*60;        // 12:00 AM

  const allowedDays = [0,1,2,3]; // Ø§Ù„Ø£Ø­Ø¯ - Ø§Ù„Ø§Ø«Ù†ÙŠÙ† - Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡ - Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡

  const video = document.getElementById("bgVideo");

  if(allowedDays.includes(day) && currentMinutes >= start && currentMinutes < end){
    video.style.display = "block";
    video.play();
  }else{
    video.pause();
    video.style.display = "none";
  }

}

// ÙØ­Øµ ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©
setInterval(checkVideoSchedule, 30000);
checkVideoSchedule();

</script>
</body>
</html>